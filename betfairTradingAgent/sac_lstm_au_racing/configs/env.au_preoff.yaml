# AU pre-off Betfair environment configuration
schema_version: env_v7_tradecost
region: "AU"

# Episode window (seconds relative to scheduled off)
t_start_s: 900          # start 15 minutes before scheduled off
t_end_s: 0              # end at suspend/in-play
episode_end_on_inplay: true
allow_delayed_off: true # tolerate late starts; see gates below

# Market selection
market_type: "WIN"
include_scratched: false
min_runners: 6
max_runners: 20

# Price ladder & microstructure
tick_ladder: "betfair_default"
max_depth_levels: 3          # top-of-book levels captured in obs
commission_rate: 0.05        # 5%
latency_ms_mean: 120
latency_ms_jitter: 60
slippage_bps_mean: 3
slippage_bps_std: 5

# Action model (hybrid recommended)
action:
  mode: "hybrid"             # "continuous" | "hybrid"
  templates:                  # for hybrid: discrete templates then continuous size refine
    - {name: "enter_back_k1",  side: "BACK", delta_ticks: -1}
    - {name: "enter_lay_k1",   side: "LAY",  delta_ticks: +1}
    - {name: "scale_in_back",  side: "BACK", delta_ticks: -2}
    - {name: "scale_in_lay",   side: "LAY",  delta_ticks: +2}
    - {name: "exit_back",      side: "BACK", delta_ticks: +1}
    - {name: "exit_lay",       side: "LAY",  delta_ticks: -1}
  size_continuous_bounds: [0.0, 1.0]   # scaled to per-runner exposure_band

# Risk & affordability gates
risk:
  per_market_loss_bps_cap: 150    # hard stop per market (~1.5%)
  per_runner_exposure_band: 1.0   # normalized; size scales to this
  reject_unaffordable_orders: true
  penalty_unaffordable_bps: 5
  cancel_replace_rate_cap: 5.0    # orders_submitted <= cap * orders_filled
  circuit_breakers:
    missing_ticks_s: 5            # if data gaps exceed this, clamp actions
    delayed_off_s: 300            # tolerate up to +5 min delay; then end episode safely

# Observation features (toggle groups)
obs:
  include_prices: true
  include_sizes: true
  include_traded_summaries: true
  include_market_aggregates: true
  include_time_features: true
  include_sidecar_predictions: true  # if you wire in the predictive model

# Logging
log:
  info_keys:
    - orders_submitted_step
    - fills_step
    - slippage_bps
    - latency_ms
    - worst_roi_step
    - green_all_step
